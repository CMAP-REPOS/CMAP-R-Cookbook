<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Arrange and save CMAP ggplot chart — finalize_plot • cmapplot</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Arrange and save CMAP ggplot chart — finalize_plot" />
<meta property="og:description" content="Place a ggplot into a frame defined by CMAP design standards. It will align
your title and caption to the left, add a horizontal line on top, and make
other adjustments. It can show you the final plot and/or export it as a raster
or vector file. This function will not apply CMAP design standards to the plot
itself: use with theme_cmap() for that. Exports from this function use
Cairo graphics drivers, while drawing within R is done with default (Windows)
drivers." />
<meta property="og:image" content="https://cmap-repos.github.io/cmapplot/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmapplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/plots.html">Creating CMAP-themed plots</a>
    </li>
    <li>
      <a href="../articles/finalize.html">Finalizing and exporting CMAP-themed plots</a>
    </li>
    <li>
      <a href="../articles/colors.html">Applying CMAP color schemes</a>
    </li>
    <li>
      <a href="../articles/cookbook.html">A cookbook for cmapplot</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/CMAP-REPOS/cmapplot/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Arrange and save CMAP ggplot chart</h1>
    <small class="dont-index">Source: <a href='https://github.com/CMAP-REPOS/cmapplot/blob/master/R/finalize_plot.R'><code>R/finalize_plot.R</code></a></small>
    <div class="hidden name"><code>finalize_plot.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Place a ggplot into a frame defined by CMAP design standards. It will align
your title and caption to the left, add a horizontal line on top, and make
other adjustments. It can show you the final plot and/or export it as a raster
or vector file. This function will not apply CMAP design standards to the plot
itself: use with <code><a href='theme_cmap.html'>theme_cmap()</a></code> for that. Exports from this function use
Cairo graphics drivers, while drawing within R is done with default (Windows)
drivers.</p>
    </div>

    <pre class="usage"><span class='fu'>finalize_plot</span><span class='op'>(</span>
  plot <span class='op'>=</span> <span class='cn'>NULL</span>,
  title <span class='op'>=</span> <span class='st'>""</span>,
  caption <span class='op'>=</span> <span class='st'>""</span>,
  width <span class='op'>=</span> <span class='fl'>670</span><span class='op'>/</span><span class='fl'>72</span>,
  height <span class='op'>=</span> <span class='fl'>400</span><span class='op'>/</span><span class='fl'>72</span>,
  title_width <span class='op'>=</span> <span class='cn'>NULL</span>,
  caption_valign <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"bottom"</span>, <span class='st'>"top"</span><span class='op'>)</span>,
  mode <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"plot"</span><span class='op'>)</span>,
  filename <span class='op'>=</span> <span class='cn'>NULL</span>,
  overwrite <span class='op'>=</span> <span class='cn'>FALSE</span>,
  ppi <span class='op'>=</span> <span class='fl'>300</span>,
  fill_bg <span class='op'>=</span> <span class='st'>"white"</span>,
  fill_canvas <span class='op'>=</span> <span class='st'>"gray90"</span>,
  overrides <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  legend_shift <span class='op'>=</span> <span class='cn'>TRUE</span>,
  debug <span class='op'>=</span> <span class='cn'>FALSE</span>,
  use_cmap_aes <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>plot</th>
      <td><p>ggplot object, the variable name of the plot you have created that
you want to finalize. If null (the default), the most recent plot will be
retrieved via <code><a href='https://ggplot2.tidyverse.org/reference/last_plot.html'>ggplot2::last_plot()</a></code>.</p></td>
    </tr>
    <tr>
      <th>title, caption</th>
      <td><p>Char, the text you want to appear in the title and
caption blocks. If empty, any non-Null values from <code>plot</code> will be
retrieved. These blocks take html formatting, so manual text breaks can be
created with <code>&lt;br&gt;</code> and formatting can be changed with <code>&lt;span&gt;</code>.</p></td>
    </tr>
    <tr>
      <th>width, height</th>
      <td><p>Numeric, the dimensions for the output image, including
the title. Units in inches, which interacts with <code>ppi</code> to define the
pixel dimensions of raster outputs. Default is 9.31 inches wide (670/72) and
5.56 inches tall (400/72), to match Comms specification for web graphics.</p></td>
    </tr>
    <tr>
      <th>title_width</th>
      <td><p>Numeric, the width in inches for the title. If unspecified,
use 25 percent of the total output width (per Comms guidance).</p></td>
    </tr>
    <tr>
      <th>caption_valign</th>
      <td><p>Char, align the caption text at the top or the bottom of
the available space between the title and bottom of image. This argument
accepts abbreviations, too: <code><a href='https://rdrr.io/r/base/c.html'>c("bottom", "b", "top", "t")</a></code>.</p></td>
    </tr>
    <tr>
      <th>mode</th>
      <td><p>Vector, the action(s) to be taken with the plot. View in R with
<code>plot</code>, the default, or <code>window</code> (<code>window</code> only works on
computers running Windows). Save using any of the following: <code>png</code>,
<code>tiff</code>, <code>jpeg</code>, <code>bmp</code>, <code>svg</code>, <code>pdf</code>, <code>ps</code>. Run
multiple simultaneous outputs with a vector, e.g. <code><a href='https://rdrr.io/r/base/c.html'>c("plot", "png",
"pdf")</a></code>.</p></td>
    </tr>
    <tr>
      <th>filename</th>
      <td><p>Char, the file path and name you want the plot to be saved to.
You may specify an extension to use. If you don't, the correct extension
will be added for you.</p></td>
    </tr>
    <tr>
      <th>overwrite</th>
      <td><p>Bool, set to <code>TRUE</code> if you would like the function to
overwrite existing files by the same name. The default is <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>ppi</th>
      <td><p>Numeric, the resolution of exported images (pixels per inch).
Default = 300.</p></td>
    </tr>
    <tr>
      <th>fill_bg, fill_canvas</th>
      <td><p>Char, strings that represent colors R can
interpret. They are used to fill behind and around the finished plot,
respectively.</p></td>
    </tr>
    <tr>
      <th>overrides</th>
      <td><p>Named list, overrides the default drawing attributes defined
in <code>cmapplot_globals$consts</code> which are drawn by
<code>finalize_plot</code>. Units are in bigpts (1/72 of an inch).</p></td>
    </tr>
    <tr>
      <th>legend_shift</th>
      <td><p>Bool, <code>TRUE</code>, the default, attempts to align the
legend all the way left (on top of the y axis labels) per CMAP design
standards. <code>FALSE</code> maintains the alignment used in the original plot.</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>Bool, <code>TRUE</code> enables outlines around components of finalized
plot. Defaults to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>use_cmap_aes</th>
      <td><p>Bool, <code>TRUE</code>, the default, temporarily implements
CMAP default aesthetic settings for geoms (see
<code><a href='cmap_default_aes.html'>apply_cmap_default_aes</a></code>) for the present plot.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>pass additional arguments to ggplot2's <code><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></code>
function to override any elements of the default CMAP theme.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>This function invisibly returns the final plot as a gTree object. If
 stored (e.g. <code>g &lt;- finalize_plot(...)</code>), the gTree can be drawn later
 with <code>grid</code> (e.g. <code><a href='https://rdrr.io/r/grid/grid.draw.html'>grid::grid.draw(g)</a></code>).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>econ_plot</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>cluster_jobchange</span>,
                    mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>
                      y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='va'>name</span>, <span class='va'>jobchange</span><span class='op'>)</span>,
                      x <span class='op'>=</span> <span class='va'>jobchange</span>,
                      fill <span class='op'>=</span> <span class='va'>category</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='theme_cmap.html'>theme_cmap</a></span><span class='op'>(</span>gridlines <span class='op'>=</span> <span class='st'>"v"</span>, vline <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='va'><a href='https://scales.r-lib.org//reference/label_number.html'>comma</a></span><span class='op'>)</span>

<span class='fu'>finalize_plot</span><span class='op'>(</span><span class='va'>econ_plot</span>,
               <span class='st'>"Cluster-level employment changes in the Chicago MSA, 2001-17"</span>,
               <span class='st'>"Source: Chicago Metropolitan Agency for Planning analysis"</span>,
               mode <span class='op'>=</span> <span class='st'>"window"</span>,
               height <span class='op'>=</span> <span class='fl'>6</span>,
               width <span class='op'>=</span> <span class='fl'>8</span>,
               title_width <span class='op'>=</span> <span class='fl'>2.5</span>,
               overrides <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>margin_plot_r <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>transit_plot</span> <span class='op'>&lt;-</span> <span class='va'>transit_ridership</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>system <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>system</span> <span class='op'>==</span> <span class='st'>"cta_bus"</span> <span class='op'>~</span> <span class='st'>"CTA (Bus)"</span>,
    <span class='va'>system</span> <span class='op'>==</span> <span class='st'>"cta_rail"</span> <span class='op'>~</span> <span class='st'>"CTA (Rail)"</span>,
    <span class='va'>system</span> <span class='op'>==</span> <span class='st'>"metra"</span> <span class='op'>~</span> <span class='st'>"Metra"</span>,
    <span class='va'>system</span> <span class='op'>==</span> <span class='st'>"pace"</span> <span class='op'>~</span> <span class='st'>"Pace"</span>,
    <span class='va'>system</span> <span class='op'>==</span> <span class='st'>"pace_ada"</span> <span class='op'>~</span> <span class='st'>"Paratransit"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>year</span>, y <span class='op'>=</span> <span class='va'>ridership</span>, color <span class='op'>=</span> <span class='va'>system</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='theme_cmap.html'>theme_cmap</a></span><span class='op'>(</span>legend.max.columns <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>

<span class='fu'>finalize_plot</span><span class='op'>(</span><span class='va'>transit_plot</span>,
              <span class='st'>"Transit ridership in the RTA region over time, 1980-2019
              (in millions)"</span>,
              <span class='st'>"Source: Chicago Metropolitan Agency for Planning
              analysis of data from the Regional Transportation Authority"</span>,
              mode<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"plot"</span>, <span class='st'>"pdf"</span><span class='op'>)</span>,
              filename <span class='op'>=</span> <span class='st'>"foo"</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matthew Stern, Sarah Buchhorn, Daniel Comeaux, Martin Menninger, Noel Peterson, Greta Ritzenthaler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


