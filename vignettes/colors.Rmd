---
title: "Applying CMAP color schemes"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Applying CMAP color schemes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.asp = 400/670,
  fig.retina = 4,
  fig.align = "center"
)

library(tidyverse)
library(cmapplot)
```

Palettes based on the CMAP color palette can be applied directly to ggplot graphics. The package contains both discrete and continuous color palettes. Each type of palette can be applied to either the color or fill attributes of a ggplot.


## Discrete palettes

Add discrete palettes by adding either the `cmap_fill_discrete()` or `cmap_color_discrete()` function to your plot construction. Note that discrete palettes will automatically interpolate additional colors if the dataset has more colors than the palette. This can be helpful but is not ideal for finished graphics. See the discrete palettes reference page for displays of all palettes.


```{r disc, eval=TRUE}
grp_over_time %>% 
    filter(category=="Goods-Producing") %>% 
    ggplot(.) +
      geom_line(aes(x=year, y=realgrp, color=cluster), 
                size=1.25) +
      cmap_color_discrete(palette = "community", reverse = TRUE) +
      theme_cmap() +
      ggtitle("Real GRP of goods-producing clusters over time")
```


## Continuous palettes

Add continuous palettes by adding either the `cmap_fill_continuous()` or `cmap_color_continuous()` function to your plot construction. For example:

```{r cont, eval=TRUE}
percentile_wages %>%
   filter(cluster %in% c("Biopharmaceuticals", "Hospitality and Tourism", "Paper and Packaging")) %>%
   ggplot(.) +
      geom_point(aes(x = cluster, y = wage, color = percentile),
                 size = 5) +
      scale_y_continuous(labels = scales::dollar) +
      cmap_color_continuous(palette = "seq_red_purple") +
      coord_flip() +
      theme_cmap() +
      ggtitle("Percentiles of wages for key clusters")
```

If you're using a divergent palette, you can specify the midpoint where the divergence begins (default is zero). See the gradients reference page for displays of all gradients.


## Race/ethnicity palette

If you have a graph with categories based on race and ethnicity, there are functions to apply pre-determined colors for each demographic group: `cmap_fill_race()` and `cmap_color_race()`. In the arguments, specify the case-sensitive name of each group as it appears in your data. The function will operate even if you do not have every group.

```{r race, eval=TRUE}
traded_emp_by_race %>%
     filter(Race!="Regional average" & variable=="SpecializedTraded") %>%
     ggplot(.) +
     geom_col(aes(x = Race, y = value, fill = Race)) +
     cmap_fill_race(white = "White", black = "Black",
                    hispanic = "Hispanic", asian = "Asian",
                    other = "Other") +
     ggtitle("Percent employed in specialized traded clusters, by race") +
     # Hiding the legend because it's redundant in this example
     theme_cmap(show.legend = FALSE)
```


## Highlighting categories

If you want to draw attention to a specific group in your graph, use `cmap_fill_highlight()` or `cmap_color_highlight()`. This will make your highlighted group one color and all other groups identical in another color. Specify the vector in your data that determines the groups, and then the value of the group to be singled out. Note that this must be the same vector specified in the fill/color aesthetic. The highlight and 'other' colors have defaults, but can be changed with hexcode strings. 

More than one category can be highlighted as well, by feeding a vector of values into the the value argument. See the reference file for details.

```{r hlgt, eval=TRUE}
transit_ridership %>% 
   filter(year=="2019") %>% 
   ggplot(.) +
     geom_col(aes(x = system, y = ridership, fill = system)) +
     cmap_fill_highlight(transit_ridership$system, "metra") +
     # The color legend is also redundant here
     theme_cmap(show.legend = FALSE) +
     ggtitle("Annual passenger trips by service, in millions")
```

